# HistoryMap 历史地理工具使用指南

欢迎使用 **HistoryMap**！这是一个基于 Leaflet 的轻量级历史地理标注与笔记工具。它专为历史爱好者和研究者设计，支持图钉管理、多维过滤、图层切换以及 Markdown 文件的导入与导出。

## ⚠️ 重要提示：关于数据安全

> **请务必阅读**：本工具主要运行在浏览器端，界面中显示的图钉笔记数据默认存储在浏览器的缓存（Local Storage）中。
> * **风险**：清理浏览器缓存、切换浏览器或使用隐私模式均会导致数据**丢失**。
> * **建议**：为了数据的安全性与持久化，每次创建或修改重要笔记后，请务必使用弹窗中的**保存**功能，将笔记导出为本地 Markdown 文件。

---

## 快速开始 (Quick Start)

1. **添加图钉**：点击工具栏的 `图钉` 按钮，进入添加模式。此时光标旁会实时显示经纬度，点击地图任意位置即可添加。
2. **填写信息**：在弹窗中填写日期、选择标签、输入笔记内容，确认后生成标记。
3. **筛选查看**：使用 `过滤` 功能，通过标签或日期区间快速定位特定的历史事件。
4. **保存数据**：点击图钉弹窗中的“保存”，将笔记下载到本地电脑备份。

---

## 功能详解

### 1. 工具栏 (Toolbar)
位于界面左上角，包含核心操作功能：

- **图钉 (Pin)**：
  - 点击后进入“添加模式”。
  - **坐标提示**：鼠标旁会悬浮显示当前位置的经纬度（保留两位小数），辅助精准定位。
  - 点击地图即可放置图钉并录入信息。
- **选择 (Select)**：点击后进入“选择模式”，用于常规的地图拖拽与浏览，避免误触添加图钉。
- **导入 (Import)**：支持导入本地保存的标准 Markdown 格式笔记文档，将历史数据恢复到地图上。

### 2. 过滤系统 (Filter)
- **标签筛选**：支持多选标签，快速显示/隐藏特定类别的笔记。
- **日期区间**：
  - 支持输入起止日期（格式：`YYYY-MM-DD`）。
  - **智能补全**：若只输入年份（不输入月、日），系统默认将起点设为该年的 **1月1日**，终点设为 **12月31日**。
  - 支持负年份（如 `-0221`）代表公元前。

### 3. 视图与图层 (View)
在视图模块中可切换多种底图以适应不同需求：
- **国内友好**：高德地图（基础/卫星）。
- **国际通用**：OpenStreetMap (OSM)。
- **高精卫星**：Google Maps（标准/卫星）。
  - *注意：Google 图层需要网络环境支持（外网访问），否则可能无法加载。*

---

## 高级配置

### 标签管理 (Tag Management)
在创建或编辑笔记时，您可以从预设列表中选择多个标签。

- **如何修改预设标签？**
  由于这是一个纯网页前端工具，出于安全限制无法直接修改服务器或本地文件。若需增减预设标签列表，请手动修改项目根目录下的 **`MapTags.md`** 文件。
  - *操作方法：用文本编辑器打开该文件，按现有格式增删标签名即可。*

---

## 常见问题 (FAQ)

**Q: 为什么我刷新浏览器或清理缓存后，地图上的图钉不见了？**
A: 这是因为数据仅保存在浏览器的临时存储中。请养成习惯，在编辑完成后点击图钉弹窗中的 `保存` 按钮，将数据导出为 `.md` 文件保存到本地。下次使用时点击 `导入` 即可恢复。

**Q: 日期格式如何填写？**
A: 推荐统一格式为 `YYYY-MM-DD`。支持负号表示公元前（如 `-0300-01-01`）。如果在过滤器中只写年份，系统会自动覆盖全年范围。

**Q: Google 卫星图层为什么是一片空白？**
A: Google 地图服务在部分地区受限。如果您无法加载，请检查网络连接（是否具备访问外网条件），或者切换至高德/OpenStreet 图层。

**Q: 如何保存为 Markdown？**
A: 在地图上点击已生成的图钉，在弹出的详情窗口中点击 `保存`，浏览器会自动下载对应的 Markdown 文件。

**Q: 为什么不能在网页界面里直接增加新标签类别？**
A: 这是一个无后端数据库的轻量级工具，网页无法直接写入本地文件系统。通过编辑 `MapTags.md` 文件是一种简单且通用的配置方式。